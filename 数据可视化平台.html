<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®å¯è§†åŒ–å¹³å° - CSVå›¾è¡¨ç”Ÿæˆå™¨</title>
    <script src="https://unpkg.com/antd@5.12.8/dist/antd.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/antd@5.12.8/dist/reset.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 24px;
        }
        .header {
            text-align: center;
            margin-bottom: 24px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 16px;
        }
        .upload-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #fafafa;
            border-radius: 6px;
            border: 1px dashed #d9d9d9;
        }
        .chart-container {
            height: 500px;
            margin: 24px 0;
        }
        .data-table {
            margin-top: 24px;
        }
        .filter-section {
            margin: 16px 0;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .file-list {
            margin-top: 16px;
        }
        .file-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: #e6f7ff;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #91d5ff;
        }
        .file-item:hover {
            background: #bae7ff;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Upload, Button, Card, Select, Table, Space, Divider, message, Row, Col } = antd;
        const { UploadOutlined, BarChartOutlined, LineChartOutlined, PieChartOutlined } = antd.icons;

        // é¢„åŠ è½½çš„CSVæ–‡ä»¶æ•°æ®
        const predefinedDatasets = {
            'æ°”æ¸©æ•°æ®.csv': `å¤©æ•°,æœ€é«˜æ°”æ¸©,æœ€ä½æ°”æ¸©
4,32,19
5,33,19
6,34,20
7,34,22
8,33,22
9,31,21
10,30,22
11,29,16
12,30,18
13,29,18
14,26,17
15,23,14
16,21,15
17,25,16
18,31,16`,

            'é˜¿é‡Œå·´å·´GMVæ•°æ®.csv': `è´¢å¹´,GMV(äº¿å…ƒ)
FY2013,10770
FY2014,16780
FY2015,24440
FY2016,30920
FY2017,37670
FY2018,48200
FY2019,57270`,

            'ç½‘è´­æ›¿ä»£ç‡æ•°æ®.csv': `å•†å“ç§ç±»,æ›¿ä»£ç‡
å®¶æ”¿ã€å®¶æ•™ã€ä¿å§†ç­‰ç”Ÿæ´»æœåŠ¡,0.959
é£æœºç¥¨ã€ç«è½¦ç¥¨,0.951
å®¶å…·,0.935
æ‰‹æœºã€æ‰‹æœºé…ä»¶,0.924
è®¡ç®—æœºåŠå…¶é…å¥—äº§å“,0.893
æ±½è½¦ç”¨å“,0.892
é€šä¿¡å……å€¼ã€æ¸¸æˆå……å€¼,0.865
ä¸ªäººæŠ¤ç†ç”¨å“,0.863
ä¹¦æŠ¥æ‚å¿—åŠéŸ³åƒåˆ¶å“,0.860
é¤é¥®ã€æ—…æ¸¸ã€ä½å®¿,0.856
å®¶ç”¨ç”µå™¨,0.854
é£Ÿå“ã€é¥®æ–™ã€çƒŸé…’ã€ä¿å¥å“,0.835
å®¶åº­æ—¥æ‚ç”¨å“,0.826
ä¿é™©ã€æ¼”å‡ºç¥¨åŠ¡,0.816
æœè£…ã€é‹å¸½ã€å®¶ç”¨çººç»‡å“,0.798
æ•°ç äº§å“,0.765
å…¶ä»–å•†å“å’ŒæœåŠ¡,0.763
å·¥è‰ºå“ã€æ”¶è—å“,0.670`,

            'ç‰©æµè´¹ç”¨æ•°æ®.csv': `æœˆä»½,å…¬å¸Aè´¹ç”¨,å…¬å¸Bè´¹ç”¨,å…¬å¸Cè´¹ç”¨
1,198,203,185
2,215,236,205
3,245,200,226
4,222,236,199
5,200,269,238
6,236,216,200
7,201,298,250
8,253,333,209
9,236,301,246
10,200,349,219
11,266,360,253
12,290,368,288`,

            'æ±½è½¦é€Ÿåº¦åˆ¶åŠ¨è·ç¦»æ•°æ®.csv': `é€Ÿåº¦(km/h),åˆ¶åŠ¨è·ç¦»(m)
10,0.5
20,2.0
30,4.4
40,7.9
50,12.3
60,17.7
70,24.1
80,31.5
90,39.9
100,49.2
110,59.5
120,70.8
130,83.1
140,96.4
150,110.7
160,126.0
170,142.2
180,159.4
190,177.6
200,196.8`,

            'ç»†æ ¹ç”Ÿç‰©é‡æ•°æ®.csv': `å­£èŠ‚,æ ‘ç§1ç”Ÿç‰©é‡,æ ‘ç§2ç”Ÿç‰©é‡,æ ‘ç§3ç”Ÿç‰©é‡,æ ‘ç§4ç”Ÿç‰©é‡,æ ‘ç§1è¯¯å·®,æ ‘ç§2è¯¯å·®,æ ‘ç§3è¯¯å·®,æ ‘ç§4è¯¯å·®
æ˜¥å­£,2.04,1.69,4.65,3.39,0.16,0.27,0.34,0.23
å¤å­£,1.57,1.61,4.99,2.33,0.08,0.14,0.32,0.23
ç§‹å­£,1.63,1.64,4.94,4.10,0.10,0.14,0.29,0.39`
        };

        // CSVè§£æå‡½æ•°
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            if (lines.length < 2) return { headers: [], data: [] };
            
            const headers = lines[0].split(',').map(h => h.trim());
            const data = lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.trim());
                const row = {};
                headers.forEach((header, index) => {
                    const value = values[index];
                    row[header] = isNaN(value) ? value : parseFloat(value);
                });
                return row;
            });
            
            return { headers, data };
        }

        // å›¾è¡¨ç”Ÿæˆå‡½æ•°
        function generateChart(chartType, data, xAxis, yAxis, series = []) {
            const chart = echarts.init(document.getElementById('chart-container'));
            
            let option = {
                title: {
                    text: `${chartType} - ${xAxis} vs ${yAxis}`,
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: series.length ? series : [yAxis],
                    top: 30
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                toolbox: {
                    feature: {
                        saveAsImage: {}
                    }
                }
            };

            switch(chartType) {
                case 'æŠ˜çº¿å›¾':
                    option.xAxis = {
                        type: 'category',
                        data: data.map(item => item[xAxis])
                    };
                    option.yAxis = { type: 'value' };
                    option.series = series.map(s => ({
                        name: s,
                        type: 'line',
                        data: data.map(item => item[s]),
                        smooth: true
                    }));
                    break;

                case 'æŸ±çŠ¶å›¾':
                    option.xAxis = {
                        type: 'category',
                        data: data.map(item => item[xAxis])
                    };
                    option.yAxis = { type: 'value' };
                    option.series = series.map(s => ({
                        name: s,
                        type: 'bar',
                        data: data.map(item => item[s])
                    }));
                    break;

                case 'é¥¼å›¾':
                    option.series = [{
                        type: 'pie',
                        radius: '50%',
                        data: data.map(item => ({
                            name: item[xAxis],
                            value: item[yAxis]
                        })),
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }];
                    break;

                case 'æ•£ç‚¹å›¾':
                    option.xAxis = { type: 'value' };
                    option.yAxis = { type: 'value' };
                    option.series = [{
                        type: 'scatter',
                        data: data.map(item => [item[xAxis], item[yAxis]]),
                        symbolSize: 20
                    }];
                    break;
            }

            chart.setOption(option);
            return chart;
        }

        function DataVisualizationApp() {
            const [currentData, setCurrentData] = useState(null);
            const [chartType, setChartType] = useState('æŠ˜çº¿å›¾');
            const [xAxis, setXAxis] = useState('');
            const [yAxis, setYAxis] = useState('');
            const [availableSeries, setAvailableSeries] = useState([]);
            const [selectedSeries, setSelectedSeries] = useState([]);

            // åŠ è½½é¢„å®šä¹‰æ•°æ®é›†
            const loadPredefinedDataset = (filename) => {
                const csvText = predefinedDatasets[filename];
                if (csvText) {
                    const parsedData = parseCSV(csvText);
                    setCurrentData(parsedData);
                    message.success(`å·²åŠ è½½æ•°æ®é›†: ${filename}`);
                }
            };

            // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
            const handleFileUpload = (file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const csvText = e.target.result;
                    const parsedData = parseCSV(csvText);
                    setCurrentData(parsedData);
                    message.success('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼');
                };
                reader.readAsText(file);
                return false; // é˜»æ­¢é»˜è®¤ä¸Šä¼ è¡Œä¸º
            };

            // å½“æ•°æ®å˜åŒ–æ—¶æ›´æ–°å¯ç”¨å­—æ®µ
            useEffect(() => {
                if (currentData && currentData.headers) {
                    setAvailableSeries(currentData.headers);
                    setXAxis(currentData.headers[0] || '');
                    setYAxis(currentData.headers[1] || '');
                    setSelectedSeries(currentData.headers.slice(1));
                }
            }, [currentData]);

            // ç”Ÿæˆå›¾è¡¨
            const handleGenerateChart = () => {
                if (!currentData || !xAxis || !yAxis) {
                    message.error('è¯·é€‰æ‹©Xè½´å’ŒYè½´æ•°æ®');
                    return;
                }

                setTimeout(() => {
                    generateChart(chartType, currentData.data, xAxis, yAxis, selectedSeries);
                }, 100);
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>ğŸ“Š æ•°æ®å¯è§†åŒ–å¹³å°</h1>
                        <p>ä¸Šä¼ CSVæ–‡ä»¶æˆ–é€‰æ‹©é¢„å®šä¹‰æ•°æ®é›†ï¼Œå¿«é€Ÿç”Ÿæˆäº¤äº’å¼å›¾è¡¨</p>
                    </div>

                    <Row gutter={[16, 16]}>
                        <Col span={8}>
                            <Card title="æ•°æ®æº" size="small">
                                <div className="upload-section">
                                    <Upload
                                        accept=".csv"
                                        beforeUpload={handleFileUpload}
                                        showUploadList={false}
                                    >
                                        <Button icon={<UploadOutlined />} type="primary">
                                            ä¸Šä¼ CSVæ–‡ä»¶
                                        </Button>
                                    </Upload>
                                    
                                    <div className="file-list">
                                        <p>é¢„å®šä¹‰æ•°æ®é›†:</p>
                                        {Object.keys(predefinedDatasets).map(filename => (
                                            <div 
                                                key={filename}
                                                className="file-item"
                                                onClick={() => loadPredefinedDataset(filename)}
                                            >
                                                {filename}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </Card>

                            <Card title="å›¾è¡¨é…ç½®" size="small" style={{ marginTop: 16 }}>
                                <Space direction="vertical" style={{ width: '100%' }}>
                                    <div>
                                        <label>å›¾è¡¨ç±»å‹:</label>
                                        <Select 
                                            value={chartType} 
                                            onChange={setChartType}
                                            style={{ width: '100%', marginTop: 8 }}
                                        >
                                            <Select.Option value="æŠ˜çº¿å›¾">ğŸ“ˆ æŠ˜çº¿å›¾</Select.Option>
                                            <Select.Option value="æŸ±çŠ¶å›¾">ğŸ“Š æŸ±çŠ¶å›¾</Select.Option>
                                            <Select.Option value="é¥¼å›¾">ğŸ¥§ é¥¼å›¾</Select.Option>
                                            <Select.Option value="æ•£ç‚¹å›¾">ğŸ”µ æ•£ç‚¹å›¾</Select.Option>
                                        </Select>
                                    </div>

                                    <div>
                                        <label>Xè½´æ•°æ®:</label>
                                        <Select 
                                            value={xAxis} 
                                            onChange={setXAxis}
                                            style={{ width: '100%', marginTop: 8 }}
                                            options={availableSeries.map(col => ({ value: col, label: col }))}
                                        />
                                    </div>

                                    <div>
                                        <label>Yè½´æ•°æ®:</label>
                                        <Select 
                                            value={yAxis} 
                                            onChange={setYAxis}
                                            style={{ width: '100%', marginTop: 8 }}
                                            options={availableSeries.map(col => ({ value: col, label: col }))}
                                        />
                                    </div>

                                    {chartType !== 'é¥¼å›¾' && (
                                        <div>
                                            <label>æ•°æ®ç³»åˆ—:</label>
                                            <Select 
                                                mode="multiple"
                                                value={selectedSeries}
                                                onChange={setSelectedSeries}
                                                style={{ width: '100%', marginTop: 8 }}
                                                options={availableSeries.map(col => ({ value: col, label: col }))}
                                            />
                                        </div>
                                    )}

                                    <Button 
                                        type="primary" 
                                        icon={<BarChartOutlined />}
                                        onClick={handleGenerateChart}
                                        style={{ width: '100%', marginTop: 16 }}
                                    >
                                        ç”Ÿæˆå›¾è¡¨
                                    </Button>
                                </Space>
                            </Card>
                        </Col>

                        <Col span={16}>
                            <Card title="å›¾è¡¨å±•ç¤º" size="small">
                                <div id="chart-container" className="chart-container"></div>
                            </Card>

                            {currentData && (
                                <Card title="æ•°æ®è¡¨æ ¼" size="small" style={{ marginTop: 16 }}>
                                    <Table 
                                        dataSource={currentData.data}
                                        columns={currentData.headers.map(header => ({
                                            title: header,
                                            dataIndex: header,
                                            key: header
                                        }))}
                                        pagination={{ pageSize: 5 }}
                                        size="small"
                                    />
                                </Card>
                            )}
                        </Col>
                    </Row>
                </div>
            );
        }

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<DataVisualizationApp />, document.getElementById('root'));
    </script>
</body>
</html>